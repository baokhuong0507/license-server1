<tr id="key-row-{{ key.id }}">
    <td>{{ key.id }}</td>
    <td><code>{{ key.key }}</code></td>
    <td>
        {% if key.status.value == 'unused' %}
            <span class="tag is-light">Unused</span>
        {% elif key.status.value == 'active' %}
            <span class="tag is-success">Active</span>
        {% elif key.status.value == 'expired' %}
            <span class="tag is-danger">Expired</span>
        {% else %}
            <span class="tag">{{ key.status.value }}</span>
        {% endif %}
    </td>
    <td>{{ key.expiry_date.strftime('%Y-%m-%d %H:%M') if key.expiry_date else 'N/A' }}</td>
    <td>{{ key.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
    <td class="has-text-centered">
        {% if key.status.value == 'unused' %}
        <button 
            class="button is-small is-info"
            hx-post="/admin/keys/{{ key.id }}/activate" 
            hx-target="#key-row-{{ key.id }}" 
            hx-swap="outerHTML">
            Activate
        </button>
        {% endif %}

        <!-- Nút xóa mới, sử dụng SweetAlert2 -->
        <button 
            class="button is-small is-danger"
            onclick="confirmDelete('{{ key.id }}')">
            Delete
        </button>
    </td>
</tr>

<script>
// Hàm JavaScript để hiển thị hộp thoại xác nhận xóa
// Đặt hàm này ở đây để nó được tải cùng với mỗi lần cập nhật của HTMX
function confirmDelete(keyId) {
    if (typeof Swal === 'undefined') {
        // Fallback nếu SweetAlert chưa tải kịp
        if (confirm('Are you sure you want to delete this?')) {
            htmx.ajax('DELETE', `/admin/keys/${keyId}`, { target: `#key-row-${keyId}`, swap: 'outerHTML' });
        }
        return;
    }

    Swal.fire({
        title: 'Are you sure?',
        text: "You won't be able to revert this!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Yes, delete it!'
    }).then((result) => {
        if (result.isConfirmed) {
            // Nếu người dùng xác nhận, gửi yêu cầu xóa bằng HTMX
            htmx.ajax('DELETE', `/admin/keys/${keyId}`, { target: `#key-row-${keyId}`, swap: 'outerHTML' });
        }
    })
}
</script>